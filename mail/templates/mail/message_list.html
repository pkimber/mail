{% extends "mail/base.html" %}

{% block title %}
  Mail messages
{% endblock title %}

{% block sub_heading %}
  Mail messages
{% endblock sub_heading %}

{% block content %}
  <div class="pure-g">
    <div class="pure-u-1">
      <div class="l-box">
        {% include 'base/_paginate.html' %}
        <table class="pure-table pure-table-bordered">
          <thead>
            <tr>
              <th>Created</th>
              <th>Message</th>
            </tr>
          </thead>
          <tbody>
            {% for e in object_list %}
              <tr valign="top">
                <td>
                  {{ e.created|date:'D jS M Y, H:i A' }}
                  {% for m in e.mail_set.all %}
                    <br />
                    <small>
                      {{ m.email }}
                      {% if m.sent %}
                        {{ m.sent|date:'d/m/Y H:i' }}
                      {% else %}
                        (pending)
                      {% endif %}
                    </small>
                  {% endfor %}
                </td>
                <td>
                  {% if e.is_mandrill %}
                    <a
                      target="_blank"
                      href="https://mandrillapp.com/templates/preview?id={{ e.template.slug }}">
                      Mandrill template
                      <i class="fa fa-external-link"></i>
                    </a>
                  {% else %}
                    <strong>{{ e.subject }}</strong>
                    <br />
                    {% autoescape off %}
                      {{ e.description|urlize|linebreaksbr }}
                    {% endautoescape off %}
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        {% include 'base/_paginate.html' %}
      </div>
    </div>
  </div>
{% endblock content %}
